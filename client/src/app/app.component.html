<div class="container">
  <header>
    <h1>{{ title }}</h1>
    <span class="spacer"></span>
    <button class="link" (click)="clear()">Clear chat</button>
  </header>

  <section class="upload">
    <div class="drop" (drop)="onDrop($event)" (dragover)="onDragOver($event)">
      <p><strong>Drop PDF/DOCX/TXT here</strong> or</p>
      <label class="btn">
        Select files
        <input type="file" multiple (change)="onPick($event)" accept=".pdf,.docx,.txt" />
      </label>
      <span *ngIf="uploading()">Uploading & processingâ€¦</span>
    </div>
  </section>

  <section class="docs" *ngIf="docs().length">
    <h2>Uploaded Notes</h2>
    <ul>
      <li *ngFor="let d of docs()">
        <label>
          <input type="checkbox" [checked]="selected().has(d.id)" (change)="toggleDoc(d.id)" />
          <strong>{{ d.name }}</strong>
          <small>({{ d.chunkCount }} chunks)</small>
        </label>
        <button class="link" (click)="doSummarize(d)">Summarize</button>
      </li>
    </ul>
  </section>

  <section class="ask">
    <h2>Ask your notes</h2>
    <div class="controls">
      <input [(ngModel)]="question" placeholder="e.g., What are the 3 key steps of cellular respiration?" />
      <label>K:
        <input type="number" [(ngModel)]="k" min="3" max="12">
      </label>
      <button class="primary" (click)="ask()">Ask</button>
    </div>
    <p class="hint">Tip: select specific docs above to narrow context. K = how many chunks to retrieve.</p>
  </section>

  <section class="chat" *ngIf="chat().length">
    <h2>Chat</h2>
    <div class="bubble" *ngFor="let m of chat()"
         [class.me]="m.role==='user'"
         [class.ai]="m.role==='assistant'">
      <pre>{{ m.content }}</pre>
      <div class="cites" *ngIf="m.citations?.length">
        <span *ngFor="let c of m.citations">[{{c.label}} {{c.name}}#{{c.chunkId}}]</span>
      </div>
    </div>
  </section>

  <section class="summary" *ngIf="summary()">
    <h2>Summary</h2>
    <pre>{{ summary() }}</pre>
  </section>

  <section class="error" *ngIf="error()">
    <strong>Error:</strong> {{ error() }}
  </section>
</div>
